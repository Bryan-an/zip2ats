#:schema node_modules/wrangler/config-schema.json
name = "zip2ats"
main = ".open-next/worker.js"
compatibility_date = "2025-12-01"
compatibility_flags = ["nodejs_compat", "global_fetch_strictly_public"]

# Static assets output generated by `pnpm build:pages` (OpenNext)
assets = { directory = ".open-next/assets", binding = "ASSETS" }

# Self-reference service binding required by OpenNext (caching, revalidation, etc.)
[[services]]
binding = "WORKER_SELF_REFERENCE"
service = "zip2ats"

# =====================================================
# D1 Database Binding
# =====================================================
[[d1_databases]]
binding = "DB"
database_name = "zip2ats-db"
database_id = "9d6f517d-81c0-43c1-93d3-e4c06c0fccba"
migrations_dir = "db/migrations"

# For local development (creates a local SQLite database)
# Run: npx wrangler d1 create zip2ats-db
# Then copy the database_id from the output

# =====================================================
# Environment Variables
# =====================================================
[vars]
ENVIRONMENT = "development"

# =====================================================
# Production Environment
# =====================================================
[env.production]
name = "zip2ats-production"

[env.production.vars]
ENVIRONMENT = "production"

[[env.production.d1_databases]]
binding = "DB"
database_name = "zip2ats-db-production"
database_id = "b33c4342-b580-47de-94f9-f65a257b331b"
migrations_dir = "db/migrations"

[[env.production.services]]
binding = "WORKER_SELF_REFERENCE"
service = "zip2ats-production"

# =====================================================
# Secrets (set via CLI)
# =====================================================
# Run: npx wrangler secret put JWT_SECRET
# Run: npx wrangler secret put CLERK_SECRET_KEY (if using Clerk)
# etc.
